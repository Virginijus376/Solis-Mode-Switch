# 1) SusidÄ—liojam URL
TOKEN_URL="https://www.soliscloud.com:13333/oauth2/token?appId=$APP_ID&secret=$APP_SECRET&date=$TODAY&time=$NOW"
echo "ğŸ”— Token URL: $TOKEN_URL"

# 2) Pulam atsakymÄ… ir jÄ¯ logâ€™inam
token_resp=$(curl -s "$TOKEN_URL")
echo "ğŸ” Raw token_resp: $token_resp"

# 3) IÅ¡tiriame JSON struktÅ«rÄ… â€“ laikas atspausdinti kelis variantus
echo "Possible fields:"
echo " .access_token:" $(echo "$token_resp" | jq -r '.access_token // "â€“"')
echo " .data.access_token:" $(echo "$token_resp" | jq -r '.data.access_token // "â€“"')
echo " .data.accessToken:" $(echo "$token_resp" | jq -r '.data.accessToken // "â€“"')
echo " .token:" $(echo "$token_resp" | jq -r '.token // "â€“"')

# 4) Kai matysite tikrÄ… laukÄ… (nebebus â€œâ€“â€ arba â€œnullâ€), naudokite tÄ… keliÄ…:
#    tarkim, pas jus pagaliau tikras rodo .data.accessToken
TOKEN=$(echo "$token_resp" | jq -r '.data.accessToken')
echo "âœ… Parsed TOKEN: $TOKEN"

# 5) Jei TOKEN vis dar tuÅ¡Äias arba null â€“ stabdom job
if [[ -z "$TOKEN" || "$TOKEN" == "null" ]]; then
  echo "âŒ Token gavimas nepavyko â€“ perÅ¾iÅ«rÄ—kite Raw token_resp aukÅ¡Äiau."
  exit 1
fi
