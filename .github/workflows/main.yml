# 1) Susidėliojam URL
TOKEN_URL="https://www.soliscloud.com:13333/oauth2/token?appId=$APP_ID&secret=$APP_SECRET&date=$TODAY&time=$NOW"
echo "🔗 Token URL: $TOKEN_URL"

# 2) Pulam atsakymą ir jį log’inam
token_resp=$(curl -s "$TOKEN_URL")
echo "🔐 Raw token_resp: $token_resp"

# 3) Ištiriame JSON struktūrą – laikas atspausdinti kelis variantus
echo "Possible fields:"
echo " .access_token:" $(echo "$token_resp" | jq -r '.access_token // "–"')
echo " .data.access_token:" $(echo "$token_resp" | jq -r '.data.access_token // "–"')
echo " .data.accessToken:" $(echo "$token_resp" | jq -r '.data.accessToken // "–"')
echo " .token:" $(echo "$token_resp" | jq -r '.token // "–"')

# 4) Kai matysite tikrą lauką (nebebus “–” arba “null”), naudokite tą kelią:
#    tarkim, pas jus pagaliau tikras rodo .data.accessToken
TOKEN=$(echo "$token_resp" | jq -r '.data.accessToken')
echo "✅ Parsed TOKEN: $TOKEN"

# 5) Jei TOKEN vis dar tuščias arba null – stabdom job
if [[ -z "$TOKEN" || "$TOKEN" == "null" ]]; then
  echo "❌ Token gavimas nepavyko – peržiūrėkite Raw token_resp aukščiau."
  exit 1
fi
